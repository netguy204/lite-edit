# Review Feedback

**Iteration:** 1
**Decision:** FEEDBACK

## Summary

Cache data structure and unit tests are solid, but invalidation is never calledâ€”cache will serve stale data after edits.

## Issues to Address

### Issue 1: crates/editor/src/drain_loop.rs:432

**Concern:** The render loop calls take_dirty_region() but does NOT call take_dirty_lines() to pass to invalidate_styled_lines(). The cache is never told which lines changed.

**Suggestion:** Add to render_if_dirty(): let dirty_lines = self.state.take_dirty_lines(); self.renderer.invalidate_styled_lines(&dirty_lines);

### Issue 2: Tab switch handling in editor_state.rs

**Concern:** When switching tabs, clear_styled_line_cache() is never called. Stale content from previous buffer will render.

**Suggestion:** Call renderer.clear_styled_line_cache() on tab switch, OR track buffer identity and clear when it changes.

### Issue 3: crates/editor/src/context.rs and buffer_target.rs

**Concern:** EditorContext.mark_dirty() receives DirtyLines but only converts to DirtyRegion, discarding the DirtyLines. Only the drag-drop path populates dirty_lines, not the main editing path.

**Suggestion:** Pass &mut DirtyLines to EditorContext and accumulate there, OR ensure all buffer mutations call self.dirty_lines.merge().


---

This file was generated by the orchestrator's review phase.
The implementer should address the issues above before the next review cycle.
